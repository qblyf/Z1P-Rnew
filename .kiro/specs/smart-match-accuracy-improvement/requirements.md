# 智能匹配准确率优化 - 需求文档

## 1. 项目概述

### 1.1 背景
当前智能匹配系统在处理1178条测试数据时，存在998条（84.7%）匹配失败的情况。通过分析Excel测试数据，发现主要问题包括：
- 771条（77.3%）完全未能匹配到SKU
- 223条（22.3%）匹配到错误的SKU
- 3条匹配到礼盒版本而非标准版本
- 1条匹配到eSIM版本而非蓝牙版本

### 1.2 目标
将智能匹配准确率从当前的15.3%提升至85%以上，重点解决以下问题：
1. SPU匹配错误（如将"vivo S30 Pro mini"匹配到"vivo S30 Pro mini 三丽鸥家族系列礼盒"）
2. SKU参数提取不准确（颜色、容量识别失败）
3. 型号识别不准确（如"WatchGT"、"Watch5"等特殊格式）
4. 版本区分不清（标准版 vs 礼盒版、蓝牙版 vs eSIM版）

## 2. 用户故事

### 2.1 作为商品管理员
**我想要**：批量输入商品名称后能准确匹配到对应的SKU  
**以便于**：快速完成商品信息录入，减少手动查找和修正的工作量  
**验收标准**：
- 输入"Vivo S30Promini 5G(12+512)可可黑"能匹配到"vivo S30 Pro mini 全网通5G 12GB+512GB 可可黑"
- 输入"VIVO WatchGT 软胶蓝牙版夏夜黑"能匹配到"vivo WATCH GT（WA2456C） 蓝牙版 夏夜黑 软胶"
- 输入"VIVO Watch5 蓝牙版辰夜黑"能匹配到"vivo WATCH 5 蓝牙版 软胶 辰夜黑"

### 2.2 作为商品管理员
**我想要**：系统能区分不同版本的商品（标准版、礼盒版、特别版）  
**以便于**：避免将标准商品匹配到礼盒或特别版  
**验收标准**：
- 输入不包含"礼盒"的商品名称时，不应匹配到礼盒版SPU
- 输入"蓝牙版"时不应匹配到"eSIM版"
- 系统能识别并优先匹配标准版本

### 2.3 作为商品管理员
**我想要**：系统能准确识别各种格式的型号名称  
**以便于**：处理不同来源、不同格式的商品名称  
**验收标准**：
- "S30Promini"、"S30 Pro mini"、"S30 Pro Mini"都能识别为同一型号
- "WatchGT"、"Watch GT"、"WATCH GT"都能识别为同一型号
- "Watch5"、"Watch 5"、"WATCH 5"都能识别为同一型号

### 2.4 作为商品管理员
**我想要**：系统能准确提取和匹配颜色信息  
**以便于**：确保匹配到正确颜色的SKU  
**验收标准**：
- "可可黑"、"薄荷青"、"柠檬黄"、"酷莓粉"等特殊颜色名称能被正确识别
- "夏夜黑"、"辰夜黑"等带修饰词的颜色能被正确识别
- 颜色变体（如"雾凇蓝"和"雾松蓝"）能被识别为相同颜色

## 3. 功能需求

### 3.1 SPU匹配优化

#### 3.1.1 版本过滤
- **需求**：在SPU匹配阶段过滤掉特殊版本
- **规则**：
  - 当输入不包含"礼盒"、"套装"、"系列"等关键词时，排除包含这些词的SPU
  - 当输入包含"蓝牙版"时，排除"eSIM版"SPU
  - 优先匹配标准版本（不含特殊标识的SPU）
- **优先级**：高

#### 3.1.2 型号标准化
- **需求**：统一处理各种型号格式
- **规则**：
  - 连写型号标准化：`Promini` → `Pro mini`、`WatchGT` → `Watch GT`
  - 空格标准化：`S30 Pro mini` 和 `S30Promini` 视为相同
  - 大小写标准化：`WATCH` 和 `Watch` 视为相同
  - 数字空格标准化：`Watch5` 和 `Watch 5` 视为相同
- **优先级**：高

#### 3.1.3 型号提取增强
- **需求**：改进型号提取算法，支持更多格式
- **规则**：
  - 支持"字母+空格+字母"格式（如"Watch GT"、"X Note"）
  - 支持"字母+数字"格式（如"Watch5"、"Y300i"）
  - 支持复杂组合（如"S30 Pro mini"、"iPhone 15 Pro Max"）
  - 移除括号内的型号代码（如"（WA2456C）"）
- **优先级**：高

### 3.2 SKU参数匹配优化

#### 3.2.1 颜色识别增强
- **需求**：提高颜色识别准确率
- **规则**：
  - 使用从实际SKU数据中提取的动态颜色列表
  - 支持复合颜色名称（如"可可黑"、"薄荷青"、"柠檬黄"）
  - 支持带修饰词的颜色（如"夏夜黑"、"辰夜黑"、"龙晶紫"）
  - 颜色变体映射（"雾凇蓝" ↔ "雾松蓝"）
- **优先级**：高

#### 3.2.2 容量提取增强
- **需求**：准确提取各种格式的容量信息
- **规则**：
  - 支持括号格式：`(12+512)`、`(12GB+512GB)`
  - 支持无括号格式：`12+512`、`12GB+512GB`
  - 支持单容量格式：`256GB`、`512GB`
  - 标准化输出格式：统一为`12+512`格式
- **优先级**：中

#### 3.2.3 版本信息提取
- **需求**：识别和提取版本信息
- **规则**：
  - 识别"蓝牙版"、"eSIM版"、"5G版"、"4G版"
  - 识别材质信息："软胶"、"皮革"、"陶瓷"
  - 在匹配时考虑版本信息的一致性
- **优先级**：中

### 3.3 匹配算法优化

#### 3.3.1 分阶段匹配
- **需求**：优化匹配流程，提高准确率
- **流程**：
  1. **SPU匹配阶段**：基于品牌+型号匹配SPU（应用版本过滤）
  2. **SKU筛选阶段**：获取该SPU下所有在用SKU
  3. **参数匹配阶段**：基于容量+颜色+版本匹配最佳SKU
- **优先级**：高

#### 3.3.2 相似度计算优化
- **需求**：改进相似度计算方法
- **权重分配**：
  - 品牌匹配：30%（必须匹配）
  - 型号匹配：50%（必须匹配）
  - 容量匹配：15%
  - 颜色匹配：5%
- **阈值设置**：
  - SPU匹配阈值：≥60%
  - SKU参数匹配阈值：≥70%
  - 综合匹配阈值：≥65%
- **优先级**：高

#### 3.3.3 匹配失败处理
- **需求**：提供详细的失败原因
- **信息**：
  - SPU未匹配：显示"未找到匹配的SPU"
  - SKU未匹配：显示"SPU已匹配，但未找到匹配的SKU"
  - 参数不匹配：显示具体哪个参数不匹配（容量/颜色）
- **优先级**：中

## 4. 非功能需求

### 4.1 性能要求
- 单条匹配响应时间：< 2秒
- 批量匹配（100条）：< 30秒
- SPU数据加载时间：< 10秒

### 4.2 准确率要求
- 整体匹配准确率：≥85%
- SPU匹配准确率：≥90%
- SKU参数匹配准确率：≥85%

### 4.3 可维护性要求
- 颜色列表可动态更新（从实际数据提取）
- 型号识别规则可配置
- 版本过滤规则可扩展

## 5. 测试数据分析

### 5.1 典型失败案例

#### 案例1：SPU匹配到错误版本
```
输入: Vivo S30Promini 5G(12+512)可可黑
错误匹配: vivo S30 Pro mini 三丽鸥家族系列礼盒
期望匹配: vivo S30 Pro mini 全网通5G 12GB+512GB 可可黑
问题: 匹配到礼盒版而非标准版
```

#### 案例2：型号识别失败
```
输入: VIVO WatchGT 软胶蓝牙版夏夜黑
错误匹配: vivo WATCH GT 2 eSIM版 曜石黑
期望匹配: vivo WATCH GT（WA2456C） 蓝牙版 夏夜黑 软胶
问题: 1) WatchGT未正确识别 2) 匹配到eSIM版而非蓝牙版 3) 颜色不匹配
```

#### 案例3：完全未匹配
```
输入: VIVO Watch5 蓝牙版辰夜黑
错误匹配: 无
期望匹配: vivo WATCH 5 蓝牙版 软胶 辰夜黑
问题: Watch5未被识别为有效型号
```

### 5.2 成功案例
```
输入: Vivo Y300i 5G 12+512雾凇蓝
成功匹配: vivo Y300i 全网通5G 12GB+512GB 雾松蓝
相似度: 100%
```

## 6. 约束条件

### 6.1 技术约束
- 必须使用现有的SDK接口（getSPUListNew、getSPUInfo、getSKUsInfo）
- 必须保持现有的UI交互方式
- 必须支持批量处理

### 6.2 业务约束
- 不能修改SPU/SKU数据结构
- 必须只匹配"在用"状态的商品
- 必须保留匹配历史记录（用于导出）

## 7. 验收标准

### 7.1 功能验收
- [ ] 使用提供的1178条测试数据，匹配准确率达到85%以上
- [ ] 所有典型失败案例都能正确匹配
- [ ] 版本过滤功能正常工作（礼盒版、eSIM版等）
- [ ] 型号识别支持所有常见格式
- [ ] 颜色识别准确率达到90%以上

### 7.2 性能验收
- [ ] 单条匹配响应时间 < 2秒
- [ ] 100条批量匹配 < 30秒
- [ ] SPU数据加载 < 10秒

### 7.3 用户体验验收
- [ ] 匹配过程有清晰的进度提示
- [ ] 失败原因有明确的说明
- [ ] 导出的CSV包含所有必要信息

## 8. 优先级排序

### P0（必须完成）
1. SPU版本过滤（解决礼盒版问题）
2. 型号标准化和提取增强（解决WatchGT、Watch5等问题）
3. 颜色识别增强（使用动态颜色列表）

### P1（应该完成）
4. 相似度计算优化
5. 容量提取增强
6. 版本信息提取和匹配

### P2（可以完成）
7. 匹配失败详细原因
8. 性能优化
9. 可配置化改进

## 9. 里程碑

### 里程碑1：核心算法优化（1-2天）
- 完成SPU版本过滤
- 完成型号标准化和提取增强
- 完成颜色识别增强

### 里程碑2：匹配流程优化（1天）
- 完成分阶段匹配流程
- 完成相似度计算优化
- 完成容量和版本信息提取

### 里程碑3：测试和调优（1天）
- 使用1178条测试数据验证
- 调整阈值和权重
- 修复发现的问题

### 里程碑4：文档和交付（0.5天）
- 更新代码注释
- 编写使用说明
- 准备演示数据
